# AGENTS.md

本文件提供給自動化/協作型開發代理（以及人類貢獻者）使用，目標是讓你在**不額外詢問**的情況下，也能在此 repo 內安全且一致地修改 VBA 巨集程式碼並完成提交。

## 專案概覽

- **主要語言/平台**: Excel VBA（`.bas` 模組）
- **目前檔案**:
  - `Module5.bas`: 內含與「產生新年度薪資明細」相關的巨集/程序（例如 `巨集3`）。

## 開發環境與前置條件

- **執行環境**: Microsoft Excel（建議 Windows 版 Excel；Mac 版亦可但 VBA/檔案系統行為可能不同）
- **基本流程**:
  - 將 `.bas` 匯入到 Excel 的 VBA 專案（VBE / Visual Basic Editor）
  - 透過 Excel 介面執行巨集、或在 VBE 中逐步偵錯（F8）

## 如何在 Excel 匯入並執行

1. 開啟 Excel，按 `Alt + F11` 開啟 VBA 編輯器（VBE）。
2. 在目標活頁簿的 VBAProject 上按右鍵 → `Import File...` → 選擇 `Module5.bas`。
3. 回到 Excel → `開發人員` → `巨集` → 選擇要執行的 Sub（例如 `巨集3`）→ `執行`。
4. 若要偵錯：在 VBE 設中斷點或使用逐步執行（F8）觀察變數。

## 測試/驗證方式（此 repo 無自動測試）

此專案屬於「在 Excel 內執行」的巨集型專案，通常沒有 CI/單元測試。請以**手動驗證**為主：

- **最小驗證**:
  - 匯入模組後，VBE 能成功編譯（`Debug` → `Compile VBAProject` 無錯）
  - 在不影響既有檔案的情況下，能執行目標巨集到關鍵步驟（例如顯示確認對話框、讀取工作表/列數等）
- **建議做法**（避免破壞資料）:
  - 使用副本活頁簿或測試資料
  - 若巨集會 `FileCopy`/刪除工作表/刪除列，務必先在測試檔中驗證

## 程式碼慣例（VBA）

請在修改時盡量提升可讀性與穩定性，但避免「大改」造成行為偏移（除非需求明確）。

- **宣告/型別**:
  - 盡量使用明確型別（`Long` 優先於 `Integer` 用於列/索引）
  - 避免未宣告變數；若可行，新增 `Option Explicit`（注意：導入後可能需要補齊既有程式的變數宣告）
- **命名**:
  - 程序/變數名稱可保留中文（與現況一致），但請保持一致且可理解
  - 工作表、檔名、年份等字串組合建議集中在少數變數中，避免散落多處
- **Excel 物件存取**:
  - 優先以明確工作表參照（例如 `Worksheets("行政總表").Cells(...)`）避免依賴 `ActiveSheet`
  - 若必須使用 `ActiveSheet`，請在流程中清楚設定/註解
- **副作用操作**:
  - 對 `Rows(...).Delete`、`Sheets.Delete`、`FileCopy`、`Workbooks.Open` 這類高風險操作，請加上：
    - 確認提示（若合適）
    - 明確路徑/檔名檢查
    - 錯誤處理（例如 `On Error GoTo`）與復原（關閉工作簿、不儲存等）

## 檔案/路徑處理建議

由於此類巨集常見問題在路徑/檔名：

- 使用完整路徑（`filePath` 建議明確設定並確保結尾有 `\` 或 `/`）
- 檔名組合請避免誤用字串相加：
  - VBA 字串串接建議用 `&`（非 `+`）
- 任何檔案存在性檢查（例如 `FileExists(...)`）若缺失，請補上或改用可靠作法。

## 變更範圍與提交規範

- **小步提交**: 一個 commit 解決一個邏輯變更（例如「新增 AGENTS.md」、「修正檔名串接」）
- **Commit 訊息**（英文/中文皆可，但要清楚）:
  - 例：`docs: add AGENTS.md for VBA workflow`
  - 例：`fix: correct file name concatenation in macro`
- **不要**:
  - 引入與需求無關的大量格式化/重排（除非同時能保證不改行為）
  - 在未驗證可編譯/可執行前提交「可能壞掉」的 VBA 變更（除非是刻意 WIP 且有說明）

## 代理工作方式（給自動化代理）

- 優先閱讀現有 `.bas` 檔，理解巨集目的與資料流
- 任何會改變輸出檔案、刪除列/工作表的行為，請在描述中明確說明風險與保護措施
- 若無法在本環境執行 Excel 驗證，至少確保語法/型別/物件參照合理，並避免新增不必要依賴
